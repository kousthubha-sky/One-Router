# ===========================================
# setup.py - Package Configuration
# ===========================================

from setuptools import setup, find_packages

with open("README.md", "r", encoding="utf-8") as fh:
    long_description = fh.read()

setup(
    name="onerouter",
    version="1.0.0",
    author="OneRouter Team",
    author_email="support@onerouter.com",
    description="Unified API client for payments, subscriptions, and more",
    long_description=long_description,
    long_description_content_type="text/markdown",
    url="https://github.com/onerouter/onerouter-python",
    packages=find_packages(exclude=["tests", "examples"]),
    classifiers=[
        "Development Status :: 4 - Beta",
        "Intended Audience :: Developers",
        "License :: OSI Approved :: MIT License",
        "Programming Language :: Python :: 3",
        "Programming Language :: Python :: 3.8",
        "Programming Language :: Python :: 3.9",
        "Programming Language :: Python :: 3.10",
        "Programming Language :: Python :: 3.11",
        "Programming Language :: Python :: 3.12",
    ],
    python_requires=">=3.8",
    install_requires=[
        "httpx>=0.25.0",
    ],
    extras_require={
        "dev": [
            "pytest>=7.0.0",
            "pytest-asyncio>=0.21.0",
            "pytest-cov>=4.0.0",
            "black>=23.0.0",
            "mypy>=1.0.0",
        ],
    },
)

# ===========================================
# README.md - Documentation
# ===========================================

"""
# OneRouter Python SDK

Official Python SDK for OneRouter - Unified API for payments, subscriptions, and more.

## Installation

```bash
pip install onerouter
```

## Quick Start

```python
from onerouter import OneRouter

# Initialize client
client = OneRouter(api_key="unf_live_xxx")

# Create payment
order = await client.payments.create(
    amount=500.00,
    currency="INR"
)

print(f"Order ID: {order['transaction_id']}")
print(f"Checkout URL: {order['checkout_url']}")
```

## Features

- ✅ **Unified API**: Single interface for Razorpay, PayPal, Stripe, etc.
- ✅ **Automatic Retries**: Built-in retry logic with exponential backoff
- ✅ **Idempotency**: Prevent duplicate payments automatically
- ✅ **Type Hints**: Full type support for better IDE autocomplete
- ✅ **Error Handling**: Comprehensive exception hierarchy
- ✅ **Async & Sync**: Support for both async/await and synchronous code

## Usage Examples

### Async Usage (Recommended)

```python
import asyncio
from onerouter import OneRouter

async def main():
    async with OneRouter(api_key="unf_live_xxx") as client:
        # Create payment
        order = await client.payments.create(
            amount=500.00,
            currency="INR",
            receipt="order_123"
        )
        
        # Get payment status
        status = await client.payments.get(order['transaction_id'])
        
        # Create refund
        refund = await client.payments.refund(
            payment_id=order['provider_order_id'],
            amount=100.00  # Partial refund
        )

asyncio.run(main())
```

### Sync Usage (for non-async code)

```python
from onerouter import OneRouterSync

client = OneRouterSync(api_key="unf_live_xxx")

try:
    # Create payment (no await needed)
    order = client.payments.create(
        amount=500.00,
        currency="INR"
    )
    print(f"Order: {order['transaction_id']}")
finally:
    client.close()
```

### Subscriptions

```python
# Create subscription
subscription = await client.subscriptions.create(
    plan_id="plan_monthly_99",
    customer_notify=True,
    total_count=12
)

# Get subscription
sub_details = await client.subscriptions.get(subscription['id'])

# Cancel subscription
await client.subscriptions.cancel(
    subscription_id=subscription['id'],
    cancel_at_cycle_end=True
)
```

### Payment Links

```python
# Create payment link
link = await client.payment_links.create(
    amount=999.00,
    description="Premium Plan",
    customer_email="user@example.com"
)

print(f"Share this link: {link['short_url']}")
```

### Error Handling

```python
from onerouter import (
    OneRouter,
    AuthenticationError,
    RateLimitError,
    ValidationError,
    APIError
)

async with OneRouter(api_key="unf_live_xxx") as client:
    try:
        order = await client.payments.create(amount=500.00)
    
    except AuthenticationError:
        print("Invalid API key")
    
    except RateLimitError as e:
        print(f"Rate limit exceeded. Retry after {e.retry_after} seconds")
    
    except ValidationError as e:
        print(f"Validation error: {e}")
    
    except APIError as e:
        print(f"API error ({e.status_code}): {e}")
```

## Configuration

```python
client = OneRouter(
    api_key="unf_live_xxx",
    base_url="https://api.onerouter.com",  # Optional: Custom API URL
    timeout=30,                             # Optional: Request timeout (seconds)
    max_retries=3                           # Optional: Max retry attempts
)
```

## API Reference

### Payments

| Method | Description |
|--------|-------------|
| `payments.create()` | Create a payment order |
| `payments.get(transaction_id)` | Get payment details |
| `payments.refund(payment_id, amount)` | Create refund |

### Subscriptions

| Method | Description |
|--------|-------------|
| `subscriptions.create()` | Create subscription |
| `subscriptions.get(subscription_id)` | Get subscription details |
| `subscriptions.cancel(subscription_id)` | Cancel subscription |

### Payment Links

| Method | Description |
|--------|-------------|
| `payment_links.create()` | Create payment link |

## Testing

```bash
# Install dev dependencies
pip install -e ".[dev]"

# Run tests
pytest

# Run with coverage
pytest --cov=onerouter tests/
```

## Support

- **Documentation**: https://docs.onerouter.com
- **GitHub**: https://github.com/onerouter/onerouter-python
- **Email**: support@onerouter.com

## License

MIT License - see LICENSE file for details
"""

# ===========================================
# pyproject.toml - Modern Configuration
# ===========================================

"""
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "onerouter"
version = "1.0.0"
description = "Unified API client for payments, subscriptions, and more"
readme = "README.md"
requires-python = ">=3.8"
license = {text = "MIT"}
authors = [
    {name = "OneRouter Team", email = "support@onerouter.com"}
]
keywords = ["payments", "razorpay", "paypal", "stripe", "unified-api"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
]

dependencies = [
    "httpx>=0.25.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "pytest-asyncio>=0.21.0",
    "pytest-cov>=4.0.0",
    "black>=23.0.0",
    "mypy>=1.0.0",
]

[project.urls]
Homepage = "https://onerouter.com"
Documentation = "https://docs.onerouter.com"
Repository = "https://github.com/onerouter/onerouter-python"
Changelog = "https://github.com/onerouter/onerouter-python/blob/main/CHANGELOG.md"

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]

[tool.black]
line-length = 88
target-version = ['py38', 'py39', 'py310', 'py311']

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
"""

# ===========================================
# tests/test_client.py - Unit Tests
# ===========================================

"""
import pytest
from onerouter import OneRouter, AuthenticationError, ValidationError

@pytest.mark.asyncio
async def test_client_initialization():
    client = OneRouter(api_key="unf_test_xxx")
    assert client is not None
    await client.close()

@pytest.mark.asyncio
async def test_invalid_api_key():
    with pytest.raises(ValueError):
        OneRouter(api_key="invalid_key")

@pytest.mark.asyncio
async def test_create_payment(mock_http_client):
    client = OneRouter(api_key="unf_test_xxx")
    
    # Mock response
    mock_http_client.request.return_value = {
        "transaction_id": "txn_123",
        "amount": 500.00,
        "status": "created"
    }
    
    order = await client.payments.create(amount=500.00, currency="INR")
    
    assert order["transaction_id"] == "txn_123"
    assert order["amount"] == 500.00
    await client.close()

@pytest.mark.asyncio
async def test_validation_error():
    client = OneRouter(api_key="unf_test_xxx")
    
    with pytest.raises(ValidationError):
        await client.payments.create(amount=-100.00)  # Invalid amount
    
    await client.close()
"""

# ===========================================
# examples/basic_usage.py - Example App
# ===========================================

"""
import asyncio
from onerouter import OneRouter

async def main():
    # Initialize client
    async with OneRouter(api_key="unf_test_xxx") as client:
        
        print("=== OneRouter SDK Example ===\\n")
        
        # 1. Create Payment
        print("1. Creating payment order...")
        order = await client.payments.create(
            amount=500.00,
            currency="INR",
            receipt="demo_order_123"
        )
        print(f"✓ Order created: {order['transaction_id']}")
        print(f"  Amount: ₹{order['amount']}")
        print(f"  Checkout URL: {order['checkout_url']}\\n")
        
        # 2. Get Payment Status
        print("2. Checking payment status...")
        status = await client.payments.get(order['transaction_id'])
        print(f"✓ Payment status: {status['status']}\\n")
        
        # 3. Create Subscription
        print("3. Creating subscription...")
        subscription = await client.subscriptions.create(
            plan_id="plan_monthly_99",
            customer_notify=True
        )
        print(f"✓ Subscription created: {subscription['id']}\\n")
        
        # 4. Create Payment Link
        print("4. Creating payment link...")
        link = await client.payment_links.create(
            amount=999.00,
            description="Premium Plan - Annual",
            customer_email="demo@example.com"
        )
        print(f"✓ Payment link: {link['short_url']}\\n")
        
        print("=== All operations completed successfully! ===")

if __name__ == "__main__":
    asyncio.run(main())
"""

# ===========================================
# CHANGELOG.md - Version History
# ===========================================

"""
# Changelog

All notable changes to this project will be documented in this file.

## [1.0.0] - 2025-01-XX

### Added
- Initial release
- Payment operations (create, get, refund)
- Subscription management
- Payment links
- Automatic retry logic
- Idempotency support
- Comprehensive error handling
- Both async and sync interfaces
- Type hints for IDE support

### Features
- Unified API for multiple payment providers
- Automatic request retries with exponential backoff
- Built-in rate limit handling
- Idempotency key generation
- Timeout configuration
- Custom base URL support

## [Unreleased]

### Planned
- Webhook signature verification
- Payout operations
- SMS/communication APIs
- File upload support
- Batch operations
"""